# Drag Preview Investigation Summary (Heading/Paragraph Blocks)

## Problem

When dragging existing Heading or Paragraph blocks (which use Tiptap for rich text editing) from one drop area to another, the drag preview (`CustomDragLayer`) shows the raw HTML tags (e.g., `<h1><span style="color: #eb1212">Ãœberschrift</span></h1>`) instead of the rendered, styled text.

## Steps Taken

1.  **Initial Investigation:** Identified `components/canvas/custom-drag-layer.tsx` as the component responsible for rendering the drag preview.
2.  **Code Review (custom-drag-layer.tsx):** Found that the `BlockPreview` component uses `dangerouslySetInnerHTML` to render `item.content`. Noticed the paragraph preview used Tailwind `prose` classes, but the heading preview did not.
3.  **Hypothesis 1:** The heading preview lacks necessary styling (like `prose`) for its inner HTML elements.
4.  **Action 1:** Added `prose prose-sm max-w-none` classes to the heading preview's container div in `custom-drag-layer.tsx`.
5.  **Result 1:** Issue persisted.
6.  **Hypothesis 2:** The HTML generated by Tiptap (`item.content`) might be incorrect (e.g., using non-standard attributes like `<span color="...">`).
7.  **Action 2:** Added temporary `console.log` statements:
    *   In `components/blocks/heading-block.tsx` to log `editor.getHTML()` on update.
    *   In `components/canvas/custom-drag-layer.tsx` to log the `item` object during drag.
8.  **Result 2 (User Provided Logs):** The logs confirmed that Tiptap generates correct, standard HTML (`<h1><span style="color: #eb1212">...</span></h1>`) and the drag layer receives this correct HTML.
9.  **Hypothesis 3:** Even with correct HTML and `prose` classes, the CSS styles are not being applied correctly within the isolated `react-dnd` drag layer environment.

## Current Proposed Plan

To diagnose Hypothesis 3, we need to inspect the computed styles of the drag preview element using browser developer tools. Since inspecting during an active drag is difficult:

1.  **Temporarily Modify `CustomDragLayer`:** Comment out the condition `!isDragging || itemType !== ItemTypes.EXISTING_BLOCK` that hides the preview when not dragging. This will make the preview element persist after a drag, allowing for inspection.
2.  **User Inspects:** The user will drag a heading block, release it, and then use browser dev tools to inspect the persistent preview element. They will check:
    *   If the container `div` has the `prose prose-sm max-w-none` classes.
    *   What CSS styles are actually computed for the inner `h1` and `span` elements.
3.  **Analyze Findings:** Based on the inspection results, determine why the styles aren't applying (e.g., missing base styles, specificity issues, Tailwind purging).
4.  **Implement Fix:** Apply the necessary fix (e.g., ensure global styles apply, adjust Tailwind config, add specific styles).
5.  **Revert Temporary Changes:** Remove the modification from `CustomDragLayer` and the diagnostic logs.
